<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

{{/* --- LOGIQUE D'IMAGE OPTIMIS√âE (1200px pour Discover & Preload) --- */}}
{{ $og_image := "" }}
{{ if .IsPage }}
{{ $img := .Params.image | default .Params.featured_image }}
{{ if $img }}
{{ $resource := resources.Get $img }}
{{ if $resource }}
{{ $optimized := $resource.Fill "1200x675 webp q70" }}
{{ $og_image = $optimized.Permalink }}
{{/* PRELOAD : Le navigateur t√©l√©charge l'image AVANT de lire le CSS */}}
<link rel="preload" as="image" href="{{ $optimized.Permalink }}" fetchpriority="high">
{{ else }}
{{ $og_image = $img | absURL }}
<link rel="preload" as="image" href="{{ $og_image }}" fetchpriority="high">
{{ end }}
{{ end }}
{{ else }}
{{ with site.Params.social.image }}{{ $og_image = . | absURL }}{{ end }}
{{ end }}

{{/* --- LOGIQUE : Description --- */}}
{{ $desc := "" }}
{{ if .IsHome }}
{{ $desc = site.Params.description }}
{{ else if .Params.description }}
{{ $desc = .Params.description }}
{{ else }}
{{ $desc = .Summary | plainify | truncate 160 }}
{{ end }}

<title>{{ if .IsHome }}{{ site.Title }} - {{ site.Params.description }}{{ else }}{{ .Title }} | {{ site.Title }}{{ end
    }}</title>

<link rel="canonical" href="{{ .Permalink }}" />

{{/* ========================================
OPTIMISATION #1 : CRITICAL CSS INLINE
======================================== */}}
<style>
    /* Critical CSS pour LCP - Above the fold uniquement */
    :root {
        --color-bg: #FEFCF5;
        --color-text-main: #451a03;
        --color-primary: #D97706;
        --color-border: #E5E0D8;
        --font-family-serif: 'Playfair Display', serif;
        --font-family-sans: 'Inter', sans-serif;
    }

    html,
    body {
        overflow-x: hidden;
        width: 100%;
        margin: 0;
        padding: 0;
        max-width: 100%;
        font-family: var(--font-family-sans);
        line-height: 1.6;
        color: var(--color-text-main);
        background-color: var(--color-bg);
        -webkit-text-size-adjust: 100%;
    }

    *,
    ::before,
    ::after {
        box-sizing: border-box;
    }

    img {
        max-width: 100%;
        height: auto;
        display: block;
    }

    h1,
    h2,
    h3 {
        font-family: var(--font-family-serif);
        font-weight: 700;
        line-height: 1.2;
        color: var(--color-text-main);
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1.5rem;
    }

    /* Header critique pour √©viter FOUC */
    .header-top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 0;
        min-height: 80px;
    }

    .logo-primary {
        font-family: var(--font-family-serif);
        font-size: clamp(2.2rem, 5vw, 3.8rem);
        font-weight: 700;
        font-style: italic;
        color: var(--color-primary);
        line-height: 0.9;
    }

    .recipe-hero-image {
        margin-top: 2rem;
        border-radius: 8px;
        overflow: hidden;
    }

    /* Hide non-critical elements during load */
    .main-nav {
        opacity: 0;
    }

    .footer-background {
        display: none;
    }
</style>

{{/* ========================================
OPTIMISATION #2 : PRECONNECT FONTS
======================================== */}}
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

{{/* ========================================
OPTIMISATION #3 : DEFER GOOGLE FONTS
======================================== */}}
<link rel="preload" as="style"
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@400;700&display=swap"
    onload="this.onload=null;this.rel='stylesheet'">
<noscript>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@400;700&display=swap"
        rel="stylesheet">
</noscript>

{{/* ========================================
OPTIMISATION #4 : DEFER MAIN CSS
======================================== */}}
{{ $style := resources.Get "css/main.css" | resources.Minify | resources.Fingerprint }}
<link rel="preload" as="style" href="{{ $style.RelPermalink }}" onload="this.onload=null;this.rel='stylesheet'">
<noscript>
    <link rel="stylesheet" href="{{ $style.RelPermalink }}">
</noscript>

{{/* Script pour charger les CSS defer√©es imm√©diatement si JS est activ√© */}}
<script>
    !function (e) { "use strict"; var t = function (t, n, r) { var o, i = e.document, c = i.createElement("link"); if (n) o = n; else { var a = (i.body || i.getElementsByTagName("head")[0]).childNodes; o = a[a.length - 1] } var l = i.styleSheets; c.rel = "stylesheet", c.href = t, c.media = "only x", function e(t) { if (i.body) return t(); setTimeout(function () { e(t) }) }(function () { o.parentNode.insertBefore(c, n ? o : o.nextSibling) }); var s = function (e) { for (var t = c.href, n = l.length; n--;)if (l[n].href === t) return e(); setTimeout(function () { s(e) }) }; return c.addEventListener && c.addEventListener("load", function () { this.media = r || "all" }), c.onloadcssdefined = s, s(function () { c.media !== r && (c.media = r) }), c }; "undefined" != typeof exports ? exports.loadCSS = t : e.loadCSS = t }("undefined" != typeof global ? global : this);
</script>

{{/* SEO / Meta Robots (Crucial pour Discover) */}}
<meta name="description" content="{{ $desc }}">
<meta name="robots" content="index, follow, max-image-preview:large">

{{/* Open Graph / Facebook */}}
<meta property="og:title" content="{{ .Title }}" />
<meta property="og:description" content="{{ $desc }}" />
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}" />
<meta property="og:url" content="{{ .Permalink }}" />
<meta property="og:site_name" content="{{ site.Title }}" />

{{ if .IsPage }}
<meta property="article:published_time" content="{{ .Date.Format " 2006-01-02T15:04:05Z07:00" }}" />
<meta property="article:modified_time" content="{{ .Lastmod.Format " 2006-01-02T15:04:05Z07:00" }}" />
{{ with .Params.categories }}
<meta property="article:section" content="{{ index . 0 }}" />
{{ end }}
{{ end }}

{{ with $og_image }}
<meta property="og:image" content="{{ . }}" />
{{ end }}

{{/* Twitter Card */}}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ .Title }}">
<meta name="twitter:description" content="{{ $desc }}">
{{ with $og_image }}
<meta name="twitter:image" content="{{ . }}">
{{ end }}

{{ with site.Params.social.twitter }}
<meta name="twitter:site" content="{{ . }}">
{{ end }}

{{/* Favicon */}}
<link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçå</text></svg>">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

{{/* Schema.org (JSON-LD) */}}
{{ if .IsPage }}
{{ partial "schema.html" . }}
{{ end }}